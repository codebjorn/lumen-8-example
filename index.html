<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta http-equiv="X-UA-Compatible" content="ie=edge">
    <title>Memoji API</title>
    <link rel="preconnect" href="https://fonts.gstatic.com">
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;600&display=swap" rel="stylesheet">
    <link href="https://unpkg.com/tailwindcss@^2/dist/tailwind.min.css" rel="stylesheet">
    <script src="https://cdn.jsdelivr.net/npm/@ryangjchandler/spruce@2.x.x/dist/spruce.umd.js"></script>
    <script src="https://cdn.jsdelivr.net/gh/alpinejs/alpine@v2.x.x/dist/alpine.min.js" defer></script>
    <style>
        body {
            font-family: 'Inter', sans-serif;
            line-height: 1.5;
        }
    </style>
</head>

<body class="bg-gray-100 w-screen h-screen flex items-center justify-center p-5">
<div class="w-full max-w-2xl flex flex-col">
    <div class="flex-1 flex items-center justify-center text-center  mb-8">
        <h1 class="text-4xl text-gray-800 mr-4 font-semibold">Memoji API</h1>
        <p style="width: 30px;" class="hover:opacity-70	transition">
            <a href="https://github.com/codebjorn/memoji-api">
                <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24">
                    <path fill="#f3f4f6"
                          d="M8.854 21.57a9.91 9.91 0 006.29.001.493.493 0 01-.644-.475c0-.338.013-1.413.013-2.75a2.368 2.368 0 00-.675-1.85c2.225-.25 4.562-1.1 4.562-4.938a3.87 3.87 0 00-1.025-2.687 3.594 3.594 0 00-.1-2.65s-.838-.275-2.75 1.025a9.427 9.427 0 00-5 0C7.612 5.958 6.775 6.22 6.775 6.22a3.593 3.593 0 00-.1 2.65 3.892 3.892 0 00-1.025 2.687c0 3.825 2.325 4.688 4.55 4.938-.368.354-.594.829-.638 1.337a2.137 2.137 0 01-2.91-.82l-.002-.005a2.001 2.001 0 00-1.538-1.025c-.837.013-.337.475.013.663.451.38.803.865 1.025 1.412.2.563.85 1.638 3.362 1.175 0 .838.013 1.625.013 1.863 0 .259-.185.551-.67.475z"/>
                    <path fill="#222934"
                          d="M12 2.083c-5.523 0-10 4.477-10 10 0 4.423 2.875 8.169 6.855 9.488.485.075.67-.216.67-.475 0-.238-.012-1.025-.012-1.863-2.513.463-3.163-.612-3.363-1.175a3.637 3.637 0 00-1.025-1.412c-.35-.188-.85-.65-.013-.663.65.07 1.223.453 1.538 1.025l.003.006a2.137 2.137 0 002.91.82c.043-.51.27-.984.637-1.338-2.225-.25-4.55-1.113-4.55-4.938a3.892 3.892 0 011.025-2.687 3.594 3.594 0 01.1-2.65s.837-.263 2.75 1.025a9.427 9.427 0 015 0c1.912-1.3 2.75-1.025 2.75-1.025.37.838.406 1.786.1 2.65a3.87 3.87 0 011.025 2.687c0 3.838-2.338 4.688-4.562 4.938.482.49.729 1.164.675 1.85 0 1.337-.013 2.412-.013 2.75a.493.493 0 00.643.476C19.124 20.253 22 16.507 22 12.083c0-5.523-4.477-10-10-10z"/>
                </svg>
            </a>
        </p>
    </div>
    <div class="bg-white shadow rounded shadow-xl w-full p-5 flex-1 flex">
        <div class="flex-1 px-2 flex items-center justify-center" x-data>
            <img class="w-44 rounded-full bg-gray-100" :src="$store.image.imageUrl()" alt="memoji">
        </div>
        <div class="flex-1 px-2">
            <div class="mb-5" id="character" x-data="select()" x-init="init('mattew')">
                <label id="character-label" class="block text-sm font-medium text-gray-700">
                    Character
                </label>
                <div class="mt-1 relative">
                    <button type="button" x-spread="toggle"
                            class="cursor-pointer relative w-full bg-white border border-gray-300 rounded-md shadow-sm pl-3 pr-10 py-2 text-left cursor-default focus:outline-none focus:ring-1 focus:ring-indigo-500 focus:border-indigo-500 sm:text-sm"
                            aria-haspopup="listbox" aria-expanded="true" aria-labelledby="character-label">
                            <span class="flex items-center">
                                <span class="capitalize" x-html="selected" class="ml-3 block truncate">
                                </span>
                            </span>
                        <span class="ml-3 absolute inset-y-0 right-0 flex items-center pr-2 pointer-events-none">
                                <svg class="h-5 w-5 text-gray-400" xmlns="http://www.w3.org/2000/svg"
                                     viewBox="0 0 20 20" fill="currentColor" aria-hidden="true">
                                    <path fill-rule="evenodd"
                                          d="M10 3a1 1 0 01.707.293l3 3a1 1 0 01-1.414 1.414L10 5.414 7.707 7.707a1 1 0 01-1.414-1.414l3-3A1 1 0 0110 3zm-3.707 9.293a1 1 0 011.414 0L10 14.586l2.293-2.293a1 1 0 011.414 1.414l-3 3a1 1 0 01-1.414 0l-3-3a1 1 0 010-1.414z"
                                          clip-rule="evenodd"/>
                                </svg>
                            </span>
                    </button>
                    <ul class="absolute z-10 mt-1 w-full bg-white shadow-lg max-h-56 rounded-md py-1 text-base ring-1 ring-black ring-opacity-5 overflow-auto focus:outline-none sm:text-sm"
                        x-spread="isOpen" tabindex="-1" role="listbox">
                        <template x-for="character in $store.image.getCharacters()" :key="character">
                            <li class="capitalize text-gray-900  transition relative py-2 pl-3 pr-9"
                                @click="update($event, updateCharacter)"
                                :class="{ 'select-none cursor-default':isSelected(character.slug), 'cursor-pointer hover:text-white hover:bg-indigo-500':!isSelected(character.slug)}"
                                :name="character.slug" :gender="character.gender" role="option">
                                <div class="flex items-center">
                                    <span x-text="character.slug" class="font-normal ml-3 block truncate"></span>
                                </div>
                                <span x-show="isSelected(character.slug)"
                                      class="text-indigo-600 absolute inset-y-0 right-0 flex items-center pr-4">
                                        <svg class="h-5 w-5" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 20 20"
                                             fill="currentColor" aria-hidden="true">
                                            <path fill-rule="evenodd"
                                                  d="M16.707 5.293a1 1 0 010 1.414l-8 8a1 1 0 01-1.414 0l-4-4a1 1 0 011.414-1.414L8 12.586l7.293-7.293a1 1 0 011.414 0z"
                                                  clip-rule="evenodd"/>
                                        </svg>
                                    </span>
                            </li>
                        </template>
                    </ul>
                </div>
            </div>
            <div class="mb-5" id="skinTone" x-data="select()" x-init="init('white')">
                <label id="skinTone-label" class="block text-sm font-medium text-gray-700">
                    Skin Tone
                </label>
                <div class="mt-1 relative">
                    <button type="button" x-spread="toggle"
                            class="cursor-pointer relative w-full bg-white border border-gray-300 rounded-md shadow-sm pl-3 pr-10 py-2 text-left cursor-default focus:outline-none focus:ring-1 focus:ring-indigo-500 focus:border-indigo-500 sm:text-sm"
                            aria-haspopup="listbox" aria-expanded="true" aria-labelledby="skinTone-label">
                            <span class="flex items-center">
                                <span class="capitalize" x-html="selected" class="ml-3 block truncate">
                                </span>
                            </span>
                        <span class="ml-3 absolute inset-y-0 right-0 flex items-center pr-2 pointer-events-none">
                                <svg class="h-5 w-5 text-gray-400" xmlns="http://www.w3.org/2000/svg"
                                     viewBox="0 0 20 20" fill="currentColor" aria-hidden="true">
                                    <path fill-rule="evenodd"
                                          d="M10 3a1 1 0 01.707.293l3 3a1 1 0 01-1.414 1.414L10 5.414 7.707 7.707a1 1 0 01-1.414-1.414l3-3A1 1 0 0110 3zm-3.707 9.293a1 1 0 011.414 0L10 14.586l2.293-2.293a1 1 0 011.414 1.414l-3 3a1 1 0 01-1.414 0l-3-3a1 1 0 010-1.414z"
                                          clip-rule="evenodd"/>
                                </svg>
                            </span>
                    </button>
                    <ul class="absolute z-10 mt-1 w-full bg-white shadow-lg max-h-56 rounded-md py-1 text-base ring-1 ring-black ring-opacity-5 overflow-auto focus:outline-none sm:text-sm"
                        x-spread="isOpen" tabindex="-1" role="listbox">
                        <template x-for="skinTone in $store.image.getAllSkinTones()" :key="skinTone">
                            <li class="capitalize text-gray-900  transition relative py-2 pl-3 pr-9"
                                @click="update($event, updateSkinTone)"
                                :class="{ 'select-none cursor-default':isSelected(skinTone), 'cursor-pointer hover:text-white hover:bg-indigo-500':!isSelected(skinTone)}"
                                :name="skinTone" role="option">
                                <div class="flex items-center">
                                    <span x-text="skinTone" class="font-normal ml-3 block truncate"></span>
                                </div>
                                <span x-show="isSelected(skinTone)"
                                      class="text-indigo-600 absolute inset-y-0 right-0 flex items-center pr-4">
                                        <svg class="h-5 w-5" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 20 20"
                                             fill="currentColor" aria-hidden="true">
                                            <path fill-rule="evenodd"
                                                  d="M16.707 5.293a1 1 0 010 1.414l-8 8a1 1 0 01-1.414 0l-4-4a1 1 0 011.414-1.414L8 12.586l7.293-7.293a1 1 0 011.414 0z"
                                                  clip-rule="evenodd"/>
                                        </svg>
                                    </span>
                            </li>
                        </template>
                    </ul>
                </div>
            </div>
            <div class="mb-5" id="posture" x-data="select()" x-init="init('happy')">
                <label id="posture-label" class="block text-sm font-medium text-gray-700">
                    Posture
                </label>
                <div class="mt-1 relative">
                    <button type="button" x-spread="toggle"
                            class="cursor-pointer relative w-full bg-white border border-gray-300 rounded-md shadow-sm pl-3 pr-10 py-2 text-left cursor-default focus:outline-none focus:ring-1 focus:ring-indigo-500 focus:border-indigo-500 sm:text-sm"
                            aria-haspopup="listbox" aria-expanded="true" aria-labelledby="posture-label">
                            <span class="flex items-center">
                                <span class="capitalize" x-html="selected" class="ml-3 block truncate">
                                </span>
                            </span>
                        <span class="ml-3 absolute inset-y-0 right-0 flex items-center pr-2 pointer-events-none">
                                <svg class="h-5 w-5 text-gray-400" xmlns="http://www.w3.org/2000/svg"
                                     viewBox="0 0 20 20" fill="currentColor" aria-hidden="true">
                                    <path fill-rule="evenodd"
                                          d="M10 3a1 1 0 01.707.293l3 3a1 1 0 01-1.414 1.414L10 5.414 7.707 7.707a1 1 0 01-1.414-1.414l3-3A1 1 0 0110 3zm-3.707 9.293a1 1 0 011.414 0L10 14.586l2.293-2.293a1 1 0 011.414 1.414l-3 3a1 1 0 01-1.414 0l-3-3a1 1 0 010-1.414z"
                                          clip-rule="evenodd"/>
                                </svg>
                            </span>
                    </button>
                    <ul class="absolute z-10 mt-1 w-full bg-white shadow-lg max-h-56 rounded-md py-1 text-base ring-1 ring-black ring-opacity-5 overflow-auto focus:outline-none sm:text-sm"
                        x-spread="isOpen" tabindex="-1" role="listbox">
                        <template x-for="posture in $store.image.getAllPostures()" :key="posture">
                            <li class="capitalize text-gray-900  transition relative py-2 pl-3 pr-9"
                                @click="update($event, updatePosture)"
                                :class="{ 'select-none cursor-default':isSelected(posture), 'cursor-pointer hover:text-white hover:bg-indigo-500':!isSelected(posture)}"
                                :name="posture" role="option">
                                <div class="flex items-center">
                                    <span x-text="posture" class="font-normal ml-3 block truncate"></span>
                                </div>
                                <span x-show="isSelected(posture)"
                                      class="text-indigo-600 absolute inset-y-0 right-0 flex items-center pr-4">
                                        <svg class="h-5 w-5" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 20 20"
                                             fill="currentColor" aria-hidden="true">
                                            <path fill-rule="evenodd"
                                                  d="M16.707 5.293a1 1 0 010 1.414l-8 8a1 1 0 01-1.414 0l-4-4a1 1 0 011.414-1.414L8 12.586l7.293-7.293a1 1 0 011.414 0z"
                                                  clip-rule="evenodd"/>
                                        </svg>
                                    </span>
                            </li>
                        </template>
                    </ul>
                </div>
            </div>
        </div>
    </div>
</div>
<script>
    Spruce.store('image', {
        base: '/api',
        gender: 'men',
        character: 'mattew',
        skinTone: 'white',
        posture: 'happy',
        characters: [],
        allSkinTones: [],
        allPostures: [],

        //getters
        userUrl() {
            return `${this.base}/${this.gender}/${this.character}`;
        },
        imageUrl() {
            return `${this.base}/${this.gender}/${this.character}/${this.skinTone}/${this.posture}`;
        },
        skinToneUrl() {
            return `${this.base}/${this.gender}/${this.character}/${this.skinTone}`;
        },
        getCharacters() {
            if (this.characters.length <= 0) {
                this.updateCharacters();
            }

            return this.characters;
        },
        getAllPostures() {
            if (this.allPostures.length <= 0) {
                this.updateAllPosture();
            }

            return this.allPostures;
        },
        getAllSkinTones() {
            if (this.allSkinTones.length <= 0) {
                this.updateAllSkinTones();
            }
            return this.allSkinTones;
        },

        //setters
        updateCharacter(character, gender = null) {
            if (gender) {
                this.gender = gender;
            }

            this.character = character;
        },
        updateSkinTone(skinTone) {
            this.skinTone = skinTone;
        },
        updatePosture(posture) {
            this.posture = posture;
        },
        updateCharacters() {
            getCharacters(`${this.base}/all`)
                .then(data => this.characters = data);

        },
        updateAllPosture() {
            getPostures(this.skinToneUrl())
                .then(data => this.allPostures = data)
        },
        updateAllSkinTones() {
            getSkinTones(this.userUrl())
                .then(data => this.allSkinTones = data);
        }
    });

    Spruce.watch('image.character', () => {
        Spruce.store('image').updateAllPosture();
        Spruce.store('image').updateAllSkinTones();
    });
    Spruce.watch('image.skinTone', () => {
        Spruce.store('image').updateAllPosture();
    });

    function select() {
        return {
            show: false,
            selected: '',
            toggle: {
                ['@click']() {
                    this.open = !this.open
                },
            },
            init(selected) {
                this.selected = selected;
            },
            close() {
                this.show = false
            },
            update(event, callback) {
                this.selected = callback(event);
            },
            isOpen: {
                ['x-show.transition.in.duration.250ms.out.duration.250ms']() {
                    return this.open
                },
                ['@click.away']() {
                    this.open = false
                },
            },
            isSelected(slug) {
                return this.selected === slug;
            },
        }
    }

    //characters
    const getCharacters = async (endpoint) => {
        return fetchData(endpoint).then(json => json);
    }

    const updateCharacter = (event) => {
        return updateSelect(event, (char, node) => {
            const gender = node.getAttribute('gender');
            Spruce.store('image').updateCharacter(char, gender);
        });
    }

    //skinTones
    const getSkinTones = async (endpoint) => {
        return fetchData(endpoint).then(json => Object.keys(json?.skinTones ?? {}));
    }

    const updateSkinTone = (event) => {
        return updateSelect(event, (skinTone) => {
            Spruce.store('image').updateSkinTone(skinTone);
        });
    }

    //postures
    const getPostures = async (endpoint) => {
        return fetchData(endpoint).then(json => Object.keys(json?.postures ?? {}));
    }

    const updatePosture = (event) => {
        return updateSelect(event, (posture) => {
            Spruce.store('image').updatePosture(posture);
        });
    }

    //misc
    const updateSelect = (event, updateCb) => {
        const node = event.currentTarget;
        const name = node.getAttribute('name');
        updateCb(name, node);
        return name;
    }

    async function fetchData(url) {
        let response = await fetch(url);
        return await response.json();
    }

</script>
</body>

</html>
